{% extends "base.html" %}
{% block head %}<link rel="stylesheet" href="../static/trial.css" /> {% endblock%}
{% block title %}ExpendAware - Transfer{% endblock %}
{% block h1 %}<h1>ExpendAware</h1>{% endblock %}
{% block content %}
<h2> Transfer </h2>
<form method="POST" id="transfer-form">
    <p>From</p>
    <select id="budget-from" name="budget-from">
        <option value="defaultOption">Select an option</option>
        {% for budget in budgets %}
            <option value="{{ budget }}">
                {{ budget.category }} -
                {{ budget.name }} has
                ${{ budget.amount }}
            </option>
        {% endfor %}
    </select>

    <p>To</p>
    <select id="budget-to" name="budget-to">
        <option value="defaultOption">Select an option</option>
        {% for budget in budgets %}
            <option value="{{ budget }}">
                {{ budget.category }} -
                {{ budget.name }} has
                ${{ budget.amount }}
            </option>
        {% endfor %}
    </select>
    
    <p>Amount</p>    
    <input
    type="number"
    id="transfer-amount"
    placeholder="Transfer Amount"
    name="transfer-amount"
    step="0.01"
    min='0'
    disabled
    />
    <div id="transfer-btn-container">
    <button type="submit" id="transfer-btn">Transfer/Submit</button>
    </div>
</form>

<form id="summary-result">
    <h2 id="summary-result-title">Result</h2>
    <ul id="summary-list">
        <li id="summary-descr-from"></li>
        <li id="summary-amount-from"></li>
        <li id="summary-descr-to"></li>
        <li id="summary-amount-to"></li>
    </ul>
</form>


<script>
    const budgetFrom = document.getElementById('budget-from');
    const budgetTo = document.getElementById('budget-to');
    const transferAmount = document.getElementById('transfer-amount');

    const summaryAmountFrom = document.getElementById('summary-amount-from');
    const summaryDescrFrom = document.getElementById('summary-descr-from');
    const summaryAmountTo = document.getElementById('summary-amount-to');
    const summaryDescrTo = document.getElementById('summary-descr-to');

    const defaultOptionFrom = budgetFrom.querySelector(`option[value="defaultOption"]`);
    const defaultOptionTo = budgetTo.querySelector(`option[value="defaultOption"]`);

    const summaryList = document.getElementById('summary-list');
    const transferBtn = document.getElementById('transfer-btn');

    
    let previousOption = null;
    defaultOptionFrom.disabled = true;
    defaultOptionTo.disabled = true;
    budgetTo.disabled = true;

    budgetFrom.addEventListener('change', function() {
        const budgetFromOption = budgetFrom.options[budgetFrom.selectedIndex];
        transferAmount.value = "";
        budgetTo.value = 'defaultOption';
        budgetTo.disabled = false;
        transferAmount.disabled = true;
        summaryList.style.display = 'none';

        if (budgetFromOption.value !== '') {
            const selectedValue = budgetFromOption.value;
            // Enable the previously disabled option
            if (previousOption !== null) {
                previousOption.disabled = false;
            }
            // Disable the currently selected option
            const budgetToOption = budgetTo.querySelector(`option[value="${selectedValue}"]`);
            budgetToOption.disabled = true;
            previousOption = budgetToOption;
        }
    });

    budgetTo.addEventListener('change', function() {
        transferAmount.value = "";
        transferAmount.disabled = false;
        summaryList.style.display = 'none';
    });

    transferAmount.addEventListener('input', function() {
        const transferAmountValue = parseFloat(transferAmount.value);
        const budgetFromOption = budgetFrom.options[budgetFrom.selectedIndex];
        const budgetToOption = budgetTo.options[budgetTo.selectedIndex];

        summaryList.style.display = 'grid';
        const budgetFromObject = JSON.parse(budgetFromOption.value.replace(/'/g, '"'));
        const budgetToObject = JSON.parse(budgetToOption.value.replace(/'/g, '"'));
        summaryDescrFrom.innerHTML = 
        `${budgetFromObject['category']} - ${budgetFromObject['name']}`

        if (`${budgetFromObject['amount'] - transferAmountValue}` < 0) {
            summaryAmountFrom.innerHTML = "Not enough funds!";
        }
        else if (isNaN(transferAmountValue) === true) {
            summaryAmountFrom.innerHTML = "$0";
        }
        else {(`${budgetFromObject['amount'] - transferAmountValue}` < 0)
            summaryAmountFrom.innerHTML = 
            `$${budgetFromObject['amount'] - transferAmountValue}`;
        }

        summaryDescrTo.innerHTML =
        `${budgetToObject['category']} - ${budgetToObject['name']}`;

        if (isNaN(transferAmountValue) === true) {
            summaryAmountTo.innerHTML = "$0";
        }
        else {
            summaryAmountTo.innerHTML = 
            `$${parseInt(budgetToObject['amount']) + transferAmountValue}`;
        }
    });

    transferBtn.addEventListener('click', function() {
        if (transferAmount.value === "") {
            alert('not ready yet');
            event.preventDefault();
        }
    });
</script>
{% endblock %}