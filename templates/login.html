
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&display=swap"
    rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/login.css" />
    <title>Login</title>
</head>

<body>
    <img id="login-logo" src="../static/images/logo.png" width="150" height="150"/>

    <div id="login-register-btn">
        <button id="login-tab" class="login-tab active" name="login-tab">Login</button>
        <button id="reg-tab" class="login-tab">Register</button>
    </div>

    <form method="POST" action=" /login " class="info-to-fill" id="login-form">
        <h1 class="info-title">Login</h1>

        <label for="email">Email Address</label>
        <input type="text" placeholder="Email Address" id="email" name="email" autocomplete="email" required/>

        <label for="password">Password</label>
        <input type="password" placeholder="Password" id="password" name="password" required/>

        <div>
            <ul id="flash-messages" class="show">
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        {% for message in messages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </ul>
        </div>
        
        <label for="remember-me">
            <input type="checkbox" id="remember-me" name="rememberMe"> 
            Remember Me
        </label>
        <button type="submit" id="login-button">Login</button>
        <a href="#" id="forgot-password">Forgot Password?</a>
    </form>
    
    
    <form method="POST" action="{{ url_for('login') }}" class="info-to-fill" id="reg-form">
        <h1 class="info-title">Register</h1>

        <label for="email">Email Address</label>
        <input type="text" placeholder="Email Address" id="reg-email" name="reg-email" required/>
        
        <label for="nickname">Name</label>
        <input type="text" placeholder="Name" id="nickname" name="nickname" required/>
        
        <label for="pwd1">Password</label>
        <input type="password" placeholder="Password" id="pwd1" name="pwd1" required/>
        
        <label for="pwd2">Confirm Password</label>
        <input type="password" placeholder="Confirm Password" id="pwd2" name="pwd2" required/>
        
        <button type="submit" id="reg-button">Register</button>

        <div id = "overlay">
            <div id="custom-alert" class="alert1">
                <div class="alert-content">
                    <span id="alert-message"></span>
                    <button id="alert-okay">x</button>
                </div>
            </div>
        </div>
    </form>

    <script>
    
    // Active Tab //
    const regForm = document.getElementById('reg-form');
        const loginTab = document.getElementById('login-tab');
        const regTab = document.getElementById('reg-tab');
        const loginForm = document.getElementById('login-form');
        regForm.style.display = "none";

        // Show Login Form & Hide Register Form//
        loginTab.addEventListener('click', function() {
            regForm.style.display = "none";
            loginForm.style.display = "flex";

            regTab.classList.remove("active")
            loginTab.classList.add("active")
        });

        // Show Register Form & Hide Login Form//
        regTab.addEventListener('click', function() {
            regForm.style.display = "flex";
            loginForm.style.display = "none";

            regTab.classList.add("active")
            loginTab.classList.remove("active")
        });
    // End of Active Tab //



    // Login Alert //
        document.addEventListener('DOMContentLoaded', function() {
            // Get the flash message
            const flashMessage = document.getElementById('flash-messages');
            
            // Check if the flash message exists
            if (flashMessage) {
                // Show & Remove message in 0 second (need this to display message first)
                setTimeout(function() {flashMessage.classList.remove('show');}, 0);
                // Set a timeout to remove flashout display
                setTimeout(function() {flashMessage.style.display = 'none';}, 4000);
            }
        });
    // End of Login Alert //


    // Register Alert //
        // User input in Register Form //
        const pwd1 = document.getElementById('pwd1');
        const pwd2 = document.getElementById('pwd2');
        const nickname = document.getElementById('nickname');
        const regEmail = document.getElementById('reg-email');
        const regBtn = document.getElementById('reg-button');
        
        // Alert Display IDs //
        const overlay = document.getElementById('overlay');
        const alertBox = document.getElementById('custom-alert');
        const alertMessage = document.getElementById('alert-message');
        const alertOkayButton = document.getElementById('alert-okay');
        // Alert Function //
        function showAlert(message) {
            alertMessage.innerHTML = message;
            //console.log(message + "outside");
            alertBox.style.display = 'block';

            alertOkayButton.addEventListener('click', function(event) {
                if (message !== "Success!") {
                    //console.log(message + "insdie");   
                    event.preventDefault();
                }
                overlay.style.display = 'none';
            });

            overlay.addEventListener('click', function(event) {
                if (event.target === overlay) {
                    overlay.style.display = 'none';
                }
            });
        }

        // Fetch login JSON and Use Alert Function
        fetch('login.json')
        .then(response => response.json())
        .then(data => {
            // Handle the retrieved JSON data
            regBtn.addEventListener('click', function(event) {
                const emailExists = data.some(x => x.email === regEmail.value);
                if (pwd1.value === "" || pwd2.value === "" || nickname.value === "" || regEmail.value == "") {
                    //event.preventDefault();
                    //overlay.style.display = "flex";
                    //showAlert("Missing Values");
                } else if (emailExists) {
                    event.preventDefault();
                    overlay.style.display = "flex";
                    showAlert("This email is already used")
                } else if (pwd1.value !== pwd2.value) {
                    event.preventDefault();
                    overlay.style.display = "flex";
                    showAlert("Both passwords are not matched");
                } else if (!(regEmail.value.includes("@"))) {
                    event.preventDefault();
                    overlay.style.display = "flex";
                    showAlert("Incorrect Email format: no @");
                } else {
                    event.preventDefault();
                    overlay.style.display = "flex";
                    alertOkayButton.innerHTML = "login";
                    showAlert("Success!");
                }
            });
        })
        .catch(error => {
            // Handle any errors
        });
    // End of Register Alert //
    </script>
</body>
